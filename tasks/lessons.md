# Lessons

## 2026-02-27

### 用户纠偏：不要停在“发现上层仓库脏改动”这一步
- 触发场景：目录位于上层大型 Git 仓库内，`git status` 输出大量无关文件。
- 本次修正规则：
  - 先在目标项目目录初始化独立 `.git` 仓库，再继续提交/推送。
  - 仅在确实会影响目标目录改动时再向用户中断确认。
  - 需要发布代码时，优先保证“目标项目可独立版本化”再做其余收尾工作。

### 用户纠偏：公式复制不能带异常换行，且要参考现有成熟实现
- 触发场景：直接读取 KaTeX annotation 文本时，复制结果出现多余换行，影响 LaTeX 可用性。
- 本次修正规则：
  - 公式复制必须先做 LaTeX 源码归一化（去除硬换行、合并多余空白）。
  - 遇到已有参考项目时，先迁移其能力模型（识别/格式/复制回退/提示），再做页面适配。
  - 复杂交互优先模块化（独立服务文件），主内容脚本仅做装配与配置同步。
