# Lessons

## 2026-02-27

### 用户纠偏：不要停在“发现上层仓库脏改动”这一步
- 触发场景：目录位于上层大型 Git 仓库内，`git status` 输出大量无关文件。
- 本次修正规则：
  - 先在目标项目目录初始化独立 `.git` 仓库，再继续提交/推送。
  - 仅在确实会影响目标目录改动时再向用户中断确认。
  - 需要发布代码时，优先保证“目标项目可独立版本化”再做其余收尾工作。

### 用户纠偏：公式复制不能带异常换行，且要参考现有成熟实现
- 触发场景：直接读取 KaTeX annotation 文本时，复制结果出现多余换行，影响 LaTeX 可用性。
- 本次修正规则：
  - 公式复制必须先做 LaTeX 源码归一化（去除硬换行、合并多余空白）。
  - 遇到已有参考项目时，先迁移其能力模型（识别/格式/复制回退/提示），再做页面适配。
  - 复杂交互优先模块化（独立服务文件），主内容脚本仅做装配与配置同步。

### 用户纠偏：按阶段推进迁移，先完成 timeline 再扩展其它能力
- 触发场景：需求包含多个迁移项时，用户明确要求先做 timeline。
- 本次修正规则：
  - 接到阶段化指令后，先聚焦当前阶段（timeline）并闭环验证，再进入下一批功能。
  - 每一阶段都要输出可运行产物（代码+打包）并同步文档状态。
  - 避免在同一迭代混入过多并行功能，保持改动职责边界清晰。

### 用户纠偏：用户限定“只迁移这几个”时，严格控制本轮范围
- 触发场景：用户点名只迁移 `sidebarAutoHide` / `folderSpacing` / `markdownPatcher` / `snowEffect`。
- 本次修正规则：
  - 本轮实现仅覆盖用户点名模块，不夹带其它迁移项。
  - 若需要公共装配改动（storage/面板），只做与这几项直接相关的最小改动。
  - 回报结果时明确“已完成模块”和“未触碰模块”，避免范围歧义。
